

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8. Adding Use Cases &mdash; METplus 4.0-beta1-dev documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />

  
  
  
  
    <link rel="canonical" href="https://dtcenter.github.io/METplus/latest/Contributors_Guide/add_use_case.html"/>
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/pop_ver.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. Documentation" href="documentation.html" />
    <link rel="prev" title="7. Testing" href="testing.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> METplus
          

          
            
            <img src="../_static/METplus_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                develop
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">METplus Wrappers Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Users_Guide/index.html">User’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Contributor’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="coding_standards.html">1. Coding Standards</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_components.html">2. Basic Components of METplus Python Wrappers</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_wrapper.html">3. How to Create Your Own Wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="conda_env.html">4. Instructions for the Conda Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="deprecation.html">5. Deprecating an Old Config Variable</a></li>
<li class="toctree-l2"><a class="reference internal" href="github_workflow.html">6. GitHub Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">7. Testing</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">8. Adding Use Cases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#work-in-a-feature-branch">8.1. Work in a Feature Branch</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-case-category-directories">8.2. Use Case Category Directories</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-case-content">8.3. Use Case Content</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configure-new-use-case">8.3.1. Configure New Use Case</a></li>
<li class="toctree-l4"><a class="reference internal" href="#document-new-use-case">8.3.2. Document New Use Case</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-the-documentation">8.3.3. Build the Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#input-data">8.4. Input Data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#providing-new-data">8.4.1. Providing new data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-new-data-to-full-sample-data-tarfile">8.4.2. Adding new data to full sample data tarfile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#check-if-the-category-tarfile-exists-already">8.4.3. Check if the category tarfile exists already</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-the-new-tarfile">8.4.4. Create the new tarfile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-volume-mount-directories-file">8.4.5. Add volume_mount_directories file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-use-case-to-the-test-suite">8.4.6. Add use case to the test suite</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-pull-request">8.4.7. Create a pull request</a></li>
<li class="toctree-l4"><a class="reference internal" href="#update-the-develop-data-directory">8.4.8. Update the develop data directory</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-case-rules">8.5. Use Case Rules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="documentation.html">9. Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">METplus</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Contributor’s Guide</a> &raquo;</li>
        
      <li><span class="section-number">8. </span>Adding Use Cases</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Contributors_Guide/add_use_case.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="adding-use-cases">
<h1><span class="section-number">8. </span>Adding Use Cases<a class="headerlink" href="#adding-use-cases" title="Permalink to this headline">¶</a></h1>
<div class="section" id="work-in-a-feature-branch">
<h2><span class="section-number">8.1. </span>Work in a Feature Branch<a class="headerlink" href="#work-in-a-feature-branch" title="Permalink to this headline">¶</a></h2>
<p>Test and develop new use cases in a GitHub feature branch.
More information on this process can be found in the
<a class="reference internal" href="github_workflow.html#github-workflow"><span class="std std-ref">GitHub Workflow</span></a> chapter.
If no GitHub issue for the new use case exists, create it, following the
instructions to fill out the template.
This branch will be the source of the pull request to merge the changes into
the develop branch.</p>
</div>
<div class="section" id="use-case-category-directories">
<h2><span class="section-number">8.2. </span>Use Case Category Directories<a class="headerlink" href="#use-case-category-directories" title="Permalink to this headline">¶</a></h2>
<p>New use cases will be put in the repository under
parm/use_cases/model_applications/&lt;CATEGORY&gt; where &lt;CATEGORY&gt; is
one of the following:</p>
<ul class="simple">
<li><p>medium_range</p></li>
<li><p>s2s (Subseasonal to Seasonal)</p></li>
<li><p>convection_allowing_models</p></li>
<li><p>data_assimilation</p></li>
<li><p>space_weather</p></li>
<li><p>marine</p></li>
<li><p>cryosphere</p></li>
<li><p>coastal</p></li>
<li><p>air_quality</p></li>
<li><p>pbl</p></li>
<li><p>land_surface</p></li>
<li><p>extremes</p></li>
<li><p>climate</p></li>
<li><p>precipitation</p></li>
<li><p>tc_and_extra_tc (Tropcial Cyclone and Extra Tropical Cyclone)</p></li>
<li><p>miscellaneous</p></li>
</ul>
<p>If you feel that the new use case does not fall into any of these categories
or are unsure which category is the most appropriate, please contact MET Help
(<a class="reference external" href="mailto:met_help&#37;&#52;&#48;ucar&#46;edu">met_help<span>&#64;</span>ucar<span>&#46;</span>edu</a>).</p>
</div>
<div class="section" id="use-case-content">
<h2><span class="section-number">8.3. </span>Use Case Content<a class="headerlink" href="#use-case-content" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configure-new-use-case">
<h3><span class="section-number">8.3.1. </span>Configure New Use Case<a class="headerlink" href="#configure-new-use-case" title="Permalink to this headline">¶</a></h3>
<p>In the category sub-directory (parm/use_cases/model_applications/&lt;CATEGORY&gt;),
each use case should have the following:</p>
<ul>
<li><p>A METplus configuration file named
&lt;MET-TOOL&gt;_fcst&lt;FCST&gt;_obs&lt;OBS&gt;_cilmo&lt;CLIMO&gt;&lt;DESCRIPTOR&gt;.conf where</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>&lt;MET-TOOL&gt;</strong> is the MET tool that performs the primary statistical
analysis, i.e. GridStat or SeriesAnalysis</p></li>
<li><p><strong>&lt;FCST&gt;</strong> is the name of the forecast input data source (this can be
excluded if no forecast data is used)</p></li>
<li><p><strong>&lt;OBS&gt;</strong> is the name of the observation input data source (this can be
excluded if no observation data is used)</p></li>
<li><p><strong>&lt;CLIMO&gt;</strong> is the optional climotology input data source (this can be
excluded if no climatology data is used)</p></li>
<li><p><strong>&lt;DESCRIPTION&gt;</strong> is an optional description that can include field
category, number of fields, statistical types, and file formats</p></li>
</ul>
</div></blockquote>
</li>
<li><p>0 or more MET configuration files named &lt;MET-TOOL&gt;Config_&lt;DESCRIPTOR&gt;</p></li>
</ul>
<p><a class="reference external" href="https://github.com/dtcenter/METplus/tree/main_v3.1/parm/use_cases/model_applications/precipitation">Click here to see an example</a></p>
</div>
<div class="section" id="document-new-use-case">
<h3><span class="section-number">8.3.2. </span>Document New Use Case<a class="headerlink" href="#document-new-use-case" title="Permalink to this headline">¶</a></h3>
<p>In the corresponding documentation category directory
(<strong>docs</strong>/use_cases/model_applications/&lt;CATEGORY&gt;), add:</p>
<ul>
<li><p>A Python Sphinx Documentation (.py) file with the same name as the METplus
configuration file</p>
<blockquote>
<div><ul class="simple">
<li><p>Users are encouraged to copy an existing documentation file and modify it
to describe the new use case.</p></li>
<li><p>Update any references to the .conf file to use the correct name</p></li>
<li><p>Update the Scientific Objective section to describe the use case</p></li>
<li><p>Update the description of the input data in the Datasets section</p></li>
<li><p>Update the list of tools used in the METplus Components section</p></li>
<li><p>Update the list of run times in the METplus Workflow section</p></li>
<li><p>Update the list of keywords, referring to <a class="reference internal" href="../Users_Guide/quicksearch.html#quick-search"><span class="std std-ref">METplus Quick Search for Use Cases</span></a> for
a list of possible keywords to use (Note: The link text for the
keywords must match the actual keyword exactly or it will not
show up in the search, i.e. <strong>ASCII2NCToolUseCase</strong> must match
<a class="reference external" href="https://dtcenter.github.io/METplus/search.html?q=**ASCII2NCToolUseCase**">https://dtcenter.github.io/METplus/search.html?q=**ASCII2NCToolUseCase**</a></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="build-the-documentation">
<h3><span class="section-number">8.3.3. </span>Build the Documentation<a class="headerlink" href="#build-the-documentation" title="Permalink to this headline">¶</a></h3>
<p>Build the documentation and ensure that the new use case file is
displayed and the formatting looks correct. The Python packages sphinx,
sphinx-gallery (0.6 or higher), and sphinx_rtd_theme are required to build.
There is a conda environment called sphinx_env available on some of the NCAR
development machines that can be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">activate</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">met_test</span><span class="o">/.</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">sphinx_env</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If conda is not already in your path, you will have to find it and run it
from the full path.</p>
</div>
<p>or you can create your own conda environment and install the packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">create</span> <span class="o">--</span><span class="n">name</span> <span class="n">sphinx_env</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.6</span>
<span class="n">conda</span> <span class="n">activate</span> <span class="n">sphinx_env</span>
<span class="n">conda</span> <span class="n">install</span> <span class="n">sphinx</span>
<span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">sphinx</span><span class="o">-</span><span class="n">gallery</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ESMCI</span><span class="o">/</span><span class="n">sphinx_rtd_theme</span><span class="nd">@version</span><span class="o">-</span><span class="n">dropdown</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">fixes</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The specific version of sphinx_rtd_theme is needed to build the documentation
with the version selector. If you are building the docs locally, you don’t
necessarily need this version. If it is easier, you can run ‘conda install
sphinx_rtd_theme’ instead of the pip from git command to install the package</p>
</div>
<p>To build the docs, run the build_docs.py script from the docs directory. Make
sure your conda environment is activated or the required packages are available
in your Python 3 environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">METplus</span><span class="o">/</span><span class="n">docs</span>
<span class="o">./</span><span class="n">build_docs</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="input-data">
<h2><span class="section-number">8.4. </span>Input Data<a class="headerlink" href="#input-data" title="Permalink to this headline">¶</a></h2>
<p>Sample input data needed to run the use case should be provided. Please try to
limit your input data to the minimum that is
needed to demonstrate your use case effectively. GRIB2 files can be pared down
to only contain the fields that are needed using wgrib2.</p>
<p>Example: To create a file called subset.grib2 that only contains TMP data from
file.grib2, run the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wgrib2</span> <span class="n">file</span><span class="o">.</span><span class="n">grib2</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">TMP</span> <span class="o">|</span> <span class="n">wgrib2</span> <span class="o">-</span><span class="n">i</span> <span class="n">file</span><span class="o">.</span><span class="n">grib2</span> <span class="o">-</span><span class="n">grib_out</span> <span class="n">subset</span><span class="o">.</span><span class="n">grib2</span>
</pre></div>
</div>
<div class="section" id="providing-new-data">
<h3><span class="section-number">8.4.1. </span>Providing new data<a class="headerlink" href="#providing-new-data" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>IMPORTANT:</strong> The following environment variables can be set to make
running these instructions easier. Make sure they are set to the correct
values that correspond to the use case being added before
copy/pasting any of these commands or there may be unintended consequences.
Copy and paste these values after you have modified them into a text file
that you can copy and paste into the terminal. <strong>You will have to do this
twice in these instructions.</strong></p>
</div>
<p>If you are using <strong>bash</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># upcoming release number, i.e. 4.0</span>
<span class="n">export</span> <span class="n">METPLUS_VERSION</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span>

<span class="c1"># use case category (see list above)</span>
<span class="n">export</span> <span class="n">USE_CASE_CATEGORY</span><span class="o">=</span><span class="n">category</span>

<span class="c1"># name of tarfile containing only the new data to add to the use case</span>
<span class="n">export</span> <span class="n">NEW_DATA_TARFILE</span><span class="o">=</span><span class="n">new_use_case_data</span><span class="o">.</span><span class="n">tgz</span>

<span class="c1"># feature branch where use case config files are checked in</span>
<span class="n">export</span> <span class="n">METPLUS_FEATURE_BRANCH</span><span class="o">=</span><span class="n">feature_XYZ_desc</span>
</pre></div>
</div>
<p>If you are using <strong>csh</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># upcoming release number, i.e. 4.0</span>
<span class="n">setenv</span> <span class="n">METPLUS_VERSION</span> <span class="n">X</span><span class="o">.</span><span class="n">Y</span>

<span class="c1"># use case category (see list above)</span>
<span class="n">setenv</span> <span class="n">USE_CASE_CATEGORY</span> <span class="n">category</span>

<span class="c1"># name of tarfile containing only the new data to add to the use case</span>
<span class="n">setenv</span> <span class="n">NEW_DATA_TARFILE</span> <span class="n">new_use_case_data</span><span class="o">.</span><span class="n">tgz</span>

<span class="c1"># feature branch where use case config files are checked in</span>
<span class="n">setenv</span> <span class="n">METPLUS_FEATURE_BRANCH</span> <span class="n">feature_XYZ_desc</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following variables do not need to be changed unless DTC moves to a
new web server, but they still need to be set to run the instructions.</p>
</div>
<p>If you are using <strong>bash</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># web server that hosts the input data</span>
<span class="n">export</span> <span class="n">DTC_WEB_SERVER</span><span class="o">=</span><span class="n">mohawk</span><span class="o">.</span><span class="n">rap</span><span class="o">.</span><span class="n">ucar</span><span class="o">.</span><span class="n">edu</span>

<span class="c1"># directory on DTC web server to put new data</span>
<span class="n">export</span> <span class="n">DATA_STAGING_DIR</span><span class="o">=/</span><span class="n">d2</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">METplus</span><span class="o">/</span><span class="n">METplus_Data_Staging</span>

<span class="c1"># directory on DTC web server that contains the data tarfiles</span>
<span class="n">export</span> <span class="n">DATA_TARFILE_DIR</span><span class="o">=/</span><span class="n">d2</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dtcenter</span><span class="o">/</span><span class="n">dfiles</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">METplus</span><span class="o">/</span><span class="n">METplus_Data</span>
</pre></div>
</div>
<p>If you are using <strong>csh</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># web server that hosts the input data</span>
<span class="n">setenv</span> <span class="n">DTC_WEB_SERVER</span> <span class="n">mohawk</span><span class="o">.</span><span class="n">rap</span><span class="o">.</span><span class="n">ucar</span><span class="o">.</span><span class="n">edu</span>

<span class="c1"># directory on DTC web server to put new data</span>
<span class="n">setenv</span> <span class="n">DATA_STAGING_DIR</span> <span class="o">/</span><span class="n">d2</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">METplus</span><span class="o">/</span><span class="n">METplus_Data_Staging</span>

<span class="c1"># directory on DTC web server that contains the data tarfiles</span>
<span class="n">setenv</span> <span class="n">DATA_TARFILE_DIR</span> <span class="o">/</span><span class="n">d2</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">dtcenter</span><span class="o">/</span><span class="n">dfiles</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">METplus</span><span class="o">/</span><span class="n">METplus_Data</span>
</pre></div>
</div>
<ul>
<li><p>Run all of the environment variable commands in your shell and verify that
they were set correctly.</p></li>
<li><p>Put new dataset into a directory that matches the use case directories, i.e.
model_applications/&lt;category&gt; or met_tool_wrapper (formerly
met_test) where &lt;category&gt; is the use case category from the list above.</p></li>
<li><p>Set directory paths in the use case config file relative to INPUT_BASE
i.e {INPUT_BASE}/model_applications/&lt;category&gt; and set {INPUT_BASE} to your
local directory to test.</p></li>
<li><p>Create a tarfile on your development machine with the new dataset. Make sure
the tarball contains directories model_applications/&lt;category&gt; or
met_tool_wrapper (formerly met_test):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tar czf ${NEW_DATA_TARFILE} model_applications/${USE_CASE_CATEGORY}
</pre></div>
</div>
</li>
<li><p>If you have access to the internal DTC web server,
copy over the tarfile to
/d2/projects/METplus/METplus_Data_Staging:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>scp ${NEW_DATA_TARFILE} ${DTC_WEB_SERVER}:${DATA_STAGING_DIR}/
</pre></div>
</div>
</li>
<li><p>If you do not, upload the tarfile to the RAL FTP:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ftp</span> <span class="o">-</span><span class="n">p</span> <span class="n">ftp</span><span class="o">.</span><span class="n">rap</span><span class="o">.</span><span class="n">ucar</span><span class="o">.</span><span class="n">edu</span>
</pre></div>
</div>
</li>
</ul>
<p>For an example on how to upload data to the ftp site see
“How to Send Us Data” on the
<a class="reference external" href="https://dtcenter.org/community-code/model-evaluation-tools-met/met-help-desk">MET Help Webpage</a>.</p>
</div>
<div class="section" id="adding-new-data-to-full-sample-data-tarfile">
<h3><span class="section-number">8.4.2. </span>Adding new data to full sample data tarfile<a class="headerlink" href="#adding-new-data-to-full-sample-data-tarfile" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Switch to the met_test user on the DTC web server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">runas</span> <span class="n">met_test</span>
</pre></div>
</div>
</li>
<li><p><strong>Run all of the environment variable commands in your shell (from the first
step) and verify that they were set correctly</strong></p></li>
<li><p>As the met_test user, create a new directory in the METplus_Data web
directory named after the branch containing the changes for the new use case.
On the DTC web server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd ${DATA_TARFILE_DIR}
mkdir ${METPLUS_FEATURE_BRANCH}
cd ${METPLUS_FEATURE_BRANCH}
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="check-if-the-category-tarfile-exists-already">
<h3><span class="section-number">8.4.3. </span>Check if the category tarfile exists already<a class="headerlink" href="#check-if-the-category-tarfile-exists-already" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Check the symbolic link in the develop directory to determine latest tarball</p></li>
</ul>
<p>If you are using <strong>bash</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>export TARFILE_TO_ADD_DATA=`ls -l ${DATA_TARFILE_DIR}/develop/sample_data-${USE_CASE_CATEGORY}.tgz | sed &#39;s|.*-&gt;||g&#39;`
echo ${TARFILE_TO_ADD_DATA}
</pre></div>
</div>
<p>If you are using <strong>csh</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>setenv TARFILE_TO_ADD_DATA `ls -l ${DATA_TARFILE_DIR}/develop/sample_data-${USE_CASE_CATEGORY}.tgz | sed &#39;s|.*-&gt;||g&#39;`
echo ${TARFILE_TO_ADD_DATA}
</pre></div>
</div>
<p><strong>If the echo command does not contain a full path to sample data tarfile, then
the sample data tarball may not exist yet for this category.</strong> Double check
that no sample data tarfiles for the category are found in any of the release
or develop directories.</p>
<ul class="simple">
<li><p>Add contents of existing tarfile to feature branch directory (if applicable)</p></li>
</ul>
<p><strong>If you have determined that there is an existing tarfile for the category
(from the previous step)</strong>, then untar the sample data tarball into
the feature branch directory. If no tarfile exists yet, you can skip this
step:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tar zxf ${TARFILE_TO_ADD_DATA} -C ${DATA_TARFILE_DIR}/${METPLUS_FEATURE_BRANCH}
</pre></div>
</div>
</div>
<div class="section" id="create-the-new-tarfile">
<h3><span class="section-number">8.4.4. </span>Create the new tarfile<a class="headerlink" href="#create-the-new-tarfile" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Untar the new data tarball into the feature branch directory:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tar zxf ${DATA_STAGING_DIR}/${NEW_DATA_TARFILE} -C ${DATA_TARFILE_DIR}/${METPLUS_FEATURE_BRANCH}
</pre></div>
</div>
<ul class="simple">
<li><p>Verify that all of the old and new data exists in the directory that was
created (i.e. model_applications/&lt;category&gt;).</p></li>
<li><p>Create the new sample data tarball. Example:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tar czf sample_data-${USE_CASE_CATEGORY}.tgz model_applications/${USE_CASE_CATEGORY}
</pre></div>
</div>
<ul>
<li><p>Remove the directory from feature branch directory. Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="n">model_applications</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="add-volume-mount-directories-file">
<h3><span class="section-number">8.4.5. </span>Add volume_mount_directories file<a class="headerlink" href="#add-volume-mount-directories-file" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Copy the volume_mount_directories file from the develop directory into the
branch directory. Update the entry for the new tarball if the mounting point
has changed (unlikely) or add a new entry if adding a new sample data
tarfile. The format of this file generally follows
&lt;category&gt;:model_applications/&lt;category&gt;, i.e.
climate:model_applications/climate:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cp ${DATA_TARFILE_DIR}/develop/volume_mount_directories ${DATA_TARFILE_DIR}/${METPLUS_FEATURE_BRANCH}
</pre></div>
</div>
</div>
<div class="section" id="add-use-case-to-the-test-suite">
<h3><span class="section-number">8.4.6. </span>Add use case to the test suite<a class="headerlink" href="#add-use-case-to-the-test-suite" title="Permalink to this headline">¶</a></h3>
<p>COMING SOON! New process for adding new use cases to the list of cases to run</p>
<p>All of the use cases in the METplus repository are run via Travis-CI to ensure
that everything runs smoothly. If the above instructions to add new data were
followed correctly, then Travis-CI will automatically obtain the
new data and use it for the tests when you push your changes to GitHub.
Adding the use case to the test suite will allow you to check that the data
was uploaded correctly and that the use case runs in the Python environment
created in Docker. The status of the tests can be viewed on the
<a class="reference external" href="https://travis-ci.com/github/dtcenter/METplus/branches">Travis-CI METplus Branches webpage</a>.
Your feature branch should be found under the Activate Branches section.
Look at the leftmost box in this row.</p>
<ul class="simple">
<li><p>A yellow box with two circles spinning indicates that the build is currently
running.</p></li>
<li><p>A yellow box with two circles that are not moving indicates that the build is
waiting to be run.</p></li>
<li><p>A green box with a check mark indicates that all of the jobs ran
successfully.</p></li>
<li><p>A red box with an X inside indicates that something went wrong.</p></li>
</ul>
<p>Click on the box to see more details. You should verify that the use case was
actually run by referring to the appropriate section under “Tests” and search
for the use case config filename in the log output.</p>
<p>MORE INFO ON THIS STEP COMING SOON!</p>
</div>
<div class="section" id="create-a-pull-request">
<h3><span class="section-number">8.4.7. </span>Create a pull request<a class="headerlink" href="#create-a-pull-request" title="Permalink to this headline">¶</a></h3>
<p>Create a pull request to merge the changes from your branch into the develop
branch. More information on this process can be found in the
<a class="reference internal" href="github_workflow.html#github-workflow"><span class="std std-ref">GitHub Workflow</span></a> chapter under
“Open a pull request using your browser.”</p>
</div>
<div class="section" id="update-the-develop-data-directory">
<h3><span class="section-number">8.4.8. </span>Update the develop data directory<a class="headerlink" href="#update-the-develop-data-directory" title="Permalink to this headline">¶</a></h3>
<p>Once the person reviewing the pull request has verified that the new use case
was run successfully using the new data,
they will need to update the links on the DTC web server before the
pull request is merged so that the develop branch will contain the new data.</p>
<ul class="simple">
<li><p>Switch to the met_test user</p></li>
<li><p><strong>Run all of the environment variable commands in your shell (from the first
step) and verify that they were set correctly</strong></p></li>
<li><p>Move new tarball to the upcoming release (i.e. v4.0) directory</p></li>
<li><p>Update symbolic link in the develop directory to point to the new data</p></li>
<li><p>Remove the feature branch directory</p></li>
<li><p>Remove feature branch Docker data volumes:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>runas met_test
cd ${DATA_TARFILE_DIR}
diff ${METPLUS_FEATURE_BRANCH}/volume_mount_directories develop/volume_mount_directories
mv ${METPLUS_FEATURE_BRANCH}/volume_mount_directories develop/volume_mount_directories
rm v${METPLUS_VERSION}/sample_data-${USE_CASE_CATEGORY}-${METPLUS_VERSION}.tgz
mv ${METPLUS_FEATURE_BRANCH}/sample_data-${USE_CASE_CATEGORY}.tgz v${METPLUS_VERSION}/sample_data-&lt;category&gt;-${METPLUS_VERSION}.tgz
cd develop
ln -s ${DATA_TARFILE_DIR}/${METPLUS_VERSION}/sample_data-${USE_CASE_CATEGORY}-${METPLUS_VERSION}.tgz sample_data-${USE_CASE_CATEGORY}.tgz
</pre></div>
</div>
<ul class="simple">
<li><p>Merge the pull request and verify that all of the Travis-CI tests pass for
the develop branch.</p></li>
</ul>
</div>
</div>
<div class="section" id="use-case-rules">
<h2><span class="section-number">8.5. </span>Use Case Rules<a class="headerlink" href="#use-case-rules" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The name of the use case files should conform to the guidelines listed above
in Use Case Content.</p></li>
<li><p>The use case METplus configuration file should not set any variables that
specific to the user’s environment, such as INPUT_BASE, OUTPUT_BASE, and
PARM_BASE.</p></li>
<li><p>A limited number of run times should be processed so that they use case runs
in a reasonable amount of time.  They are designed to demonstrate the
functionality but not necessarily processed all of the data that would be
processed for analysis. Users can take an example and modify the run times
to produce more output as desired.</p></li>
<li><p>No errors should result from running the use case.</p></li>
<li><p>All data that is input to the use case (not generated by MET/METplus) should
be referenced relative to {INPUT_BASE} and the directory structure of the
use case. For example, if adding a new model application use case found under
model_applications/precipitation, the input directory should be relative to
{INPUT_BASE}/model_applications/precipitation.</p></li>
<li><p>The input data required to run the use case should be added to the METplus
input data directory on the primary DTC web server following the instructions
above.</p></li>
<li><p>All data written by METplus should be referenced relative to {OUTPUT_BASE}.</p></li>
<li><p>The Sphinx documentation file should be as complete as possible, listing as
much relevant information about the use case as possible. Keyword tags should
be used so that users can locate other use cases that exhibit common
functionality/data sources/tools/etc. If a new keyword is used, it should be
added to the Quick Search Guide (docs/Users_Guide/quicksearch.rst).</p></li>
<li><p>The use case should be run by someone other than the author to ensure that it
runs smoothly outside of the development environment set up by the author.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="documentation.html" class="btn btn-neutral float-right" title="9. Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="testing.html" class="btn btn-neutral float-left" title="7. Testing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, UCAR/NCAR, NOAA, CSU/CIRA, and CU/CIRES

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
     
<script>var version_json_loc = "../../versions.json";</script>


</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>