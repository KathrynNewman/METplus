

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.2.6.7. UserScript: Calculate the Difficulty Index &mdash; METplus 4.0.0-rc1-dev documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://dtcenter.github.io/METplus/latest/generated/model_applications/medium_range/UserScript_fcstGEFS_Difficulty_Index.html"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/theme_override.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../_static/gallery-binder.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../_static/gallery-dataframe.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="METplus 4.0.0-rc1-dev documentation" href="../../../index.html"/>
        <link rel="up" title="5.2. Model Applications" href="../index.html"/>
        <link rel="next" title="5.2.6.8. Multi_Tool: Feature Relative by Init" href="TCStat_SeriesAnalysis_fcstGFS_obsGFS_FeatureRelative_SeriesByInit.html"/>
        <link rel="prev" title="5.2.6.6. Grid-Stat: Standard Verification of Surface Fields" href="GridStat_fcstGFS_obsGFS_Sfc_MultiField.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> METplus
          

          
            
            <img src="../../../_static/METplus_logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                
                  <div class="version-dropdown">
                    <select class="version-list" id="version-list">
                      <option value=''>develop</option>
                      
                        
                          <option value="../latest">latest</option>
                        
                      
                        
                      
                    </select>
                  </div>
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">METplus Wrappers Guides</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../Users_Guide/index.html">User’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../Users_Guide/overview.html">1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Users_Guide/installation.html">2. Software Installation/Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Users_Guide/systemconfiguration.html">3. System Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Users_Guide/wrappers.html">4. Python Wrappers</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../Users_Guide/usecases.html">5. METplus Use Cases</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../met_tool_wrapper/index.html">5.1. MET tools</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">5.2. Model Applications</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../index.html#air-quality-and-composition">5.2.1. Air Quality and Composition</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#climate">5.2.2. Climate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#convection-allowing-models">5.2.3. Convection Allowing Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#cryosphere">5.2.4. Cryosphere</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#data-assimilation">5.2.5. Data Assimilation</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../index.html#medium-range">5.2.6. Medium Range</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#precipitation">5.2.7. Precipitation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#subseasonal-to-seasonal">5.2.8. Subseasonal to Seasonal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#space-weather">5.2.9. Space Weather</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#tropical-cyclone-and-extra-tropical-cyclone">5.2.10. Tropical Cyclone and Extra Tropical Cyclone</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../Users_Guide/references.html">6. References</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Users_Guide/quicksearch.html">7. METplus Quick Search for Use Cases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Users_Guide/glossary.html">8. METplus Configuration Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Users_Guide/index.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Contributors_Guide/index.html">Contributor’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Release_Guide/index.html">Release Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Verification_Datasets/index.html">Verification Datasets Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">METplus</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../Users_Guide/index.html">User’s Guide</a> &raquo;</li>
        
          <li><a href="../../../Users_Guide/usecases.html"><span class="section-number">5. </span>METplus Use Cases</a> &raquo;</li>
        
          <li><a href="../index.html"><span class="section-number">5.2. </span>Model Applications</a> &raquo;</li>
        
      <li><span class="section-number">5.2.6.7. </span>UserScript: Calculate the Difficulty Index</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/generated/model_applications/medium_range/UserScript_fcstGEFS_Difficulty_Index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-generated-model-applications-medium-range-userscript-fcstgefs-difficulty-index-py"><span class="std std-ref">here</span></a>     to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="userscript-calculate-the-difficulty-index">
<span id="sphx-glr-generated-model-applications-medium-range-userscript-fcstgefs-difficulty-index-py"></span><h1><span class="section-number">5.2.6.7. </span>UserScript: Calculate the Difficulty Index<a class="headerlink" href="#userscript-calculate-the-difficulty-index" title="Permalink to this headline">¶</a></h1>
<p>model_applications/medium_range/
UserScript_fcstGEFS
_Difficulty_Index.conf</p>
<div class="section" id="scientific-objective">
<h2>Scientific Objective<a class="headerlink" href="#scientific-objective" title="Permalink to this headline">¶</a></h2>
<p>This use case calls the UserScript wrapper to run a user provided script that calculates
the difficulty index for windspeed. This use case allows for the user to change a variety
of variables needed to run the difficulty index (i.e. threshold start and units) so that
user can run the script at different thresholds without needing to alter the code. This
script run by the use case uses METcalcpy to provide the difficulty index calculation and
METplotpy to provide the plotting capability.</p>
<p>The difficulty index was developed by the Naval Research Lab (NRL). The overall aim of the
difficulty index is to graphically represent the expected difficulty of a decision based on
a set of forecasts (ensemble) of, e.g., significant wave height as a function of space and
time. There are two basic factors that can make a decision difficult. The first factor is the
proximity of the ensemble mean forecast to a decision threshold, e.g. 12 ft seas. If the
ensemble mean is either much lower or much higher than the threshold, the decision is easier;
if it is closer to the threshold, the decision is harder. The second factor is the forecast
precision, or ensemble spread. The greater the spread around the ensemble mean, the more likely
it is that there will be ensemble members both above and below the decision threshold, making
the decision harder. (A third factor that we will not address here is undiagnosed systematic
error, which adds uncertainty in a similar way to ensemble spread.) The challenge is combining
these factors into a continuous function that allows the user to assess relative risk.</p>
</div>
<div class="section" id="datasets">
<h2>Datasets<a class="headerlink" href="#datasets" title="Permalink to this headline">¶</a></h2>
<p>This use case calculates the difficulty index for windspeed using NCEP
GEFS ensemble data. The data is composed of 30 ensemble members that
have been compiled and compressed into one .npz file.</p>
<blockquote>
<div><ul class="simple">
<li><p>Variables required to calculate the difficulty index:
Levels required: 10-m
#. v- component of wind
#. u- component of wind
#. Windspeed
#. Latitude
#. Longitude</p></li>
<li><p>Forecast dataset: NCEP GEFS 30 member Ensemble
- Initialization date: 20191208
- Initialization hours: 12 UTC
- Lead times: 60
- Format: Grib2
- Resolution: 0.5 degree</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="metplus-components">
<h2>METplus Components<a class="headerlink" href="#metplus-components" title="Permalink to this headline">¶</a></h2>
<p>This use case runs the UserScript wrapper tool to run a user provided script,
in this case, wind_difficulty_index.py.</p>
</div>
<div class="section" id="metplus-workflow">
<h2>METplus Workflow<a class="headerlink" href="#metplus-workflow" title="Permalink to this headline">¶</a></h2>
<p>This use case loops by process which means that each tool is run for all times before moving to the
next tool. The tool order is as follows:</p>
<p>UserScript</p>
<p>This example loops by initialization time (with begin, end, and increment as specified in the
METplus UserScript_fcstGEFS_Difficulty_Index.conf file).</p>
<p>1 initialization time will be run over 1 lead time:</p>
<div class="line-block">
<div class="line"><strong>Init:</strong> 20201208_12Z</div>
<div class="line"><strong>Forecast lead:</strong> 60</div>
</div>
</div>
<div class="section" id="metplus-configuration">
<h2>METplus Configuration<a class="headerlink" href="#metplus-configuration" title="Permalink to this headline">¶</a></h2>
<p>METplus first loads all of the configuration files found in parm/metplus_config,
then it loads any configuration files passed to METplus via the command line
with the -c option, i.e. -c parm/use_cases/model_applications/medium_range/UserScript_fcstGEFS_Difficulty_Index.conf</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>config<span class="o">]</span>

<span class="c1"># List of applications to run</span>
<span class="nv">PROCESS_LIST</span> <span class="o">=</span> UserScript

<span class="c1"># time looping - options are INIT, VALID, RETRO, and REALTIME</span>
<span class="c1"># If set to INIT or RETRO:</span>
<span class="c1">#   INIT_TIME_FMT, INIT_BEG, INIT_END, and INIT_INCREMENT must also be set</span>
<span class="c1"># If set to VALID or REALTIME:</span>
<span class="c1">#   VALID_TIME_FMT, VALID_BEG, VALID_END, and VALID_INCREMENT must also be set</span>
<span class="nv">LOOP_BY</span> <span class="o">=</span> INIT

<span class="c1"># Format of INIT_BEG and INIT_END using % items</span>
<span class="c1"># %Y = 4 digit year, %m = 2 digit month, %d = 2 digit day, etc.</span>
<span class="c1"># see www.strftime.org for more information</span>
<span class="c1"># %Y%m%d%H expands to YYYYMMDDHH</span>
<span class="nv">INIT_TIME_FMT</span> <span class="o">=</span> %Y%m%d%H

<span class="c1"># Start time for METplus run - must match VALID_TIME_FMT</span>
<span class="nv">INIT_BEG</span> <span class="o">=</span> <span class="m">2020120812</span>

<span class="c1"># End time for METplus run - must match VALID_TIME_FMT</span>
<span class="nv">INIT_END</span> <span class="o">=</span> <span class="m">2020120812</span>

<span class="c1"># Increment between METplus runs (in seconds if no units are specified)</span>
<span class="c1">#  Must be &gt;= 60 seconds</span>
<span class="nv">INIT_INCREMENT</span> <span class="o">=</span> 12H

<span class="c1"># List of forecast leads to process for each run time (init or valid)</span>
<span class="c1"># In hours if units are not specified</span>
<span class="c1"># If unset, defaults to 0 (don&#39;t loop through forecast leads)</span>
<span class="nv">LEAD_SEQ</span> <span class="o">=</span> 

<span class="c1"># Order of loops to process data - Options are times, processes</span>
<span class="c1"># Not relevant if only one item is in the PROCESS_LIST</span>
<span class="c1"># times = run all wrappers in the PROCESS_LIST for a single run time, then</span>
<span class="c1">#   increment the run time and run all wrappers again until all times have</span>
<span class="c1">#   been evaluated.</span>
<span class="c1"># processes = run the first wrapper in the PROCESS_LIST for all times</span>
<span class="c1">#   specified, then repeat for the next item in the PROCESS_LIST until all</span>
<span class="c1">#   wrappers have been run</span>
<span class="nv">LOOP_ORDER</span> <span class="o">=</span> processes

<span class="c1"># list of strings to loop over for each run time.</span>
<span class="c1"># value for each item can be referenced in filename templates with {custom?fmt=%s}</span>
<span class="nv">USER_SCRIPT_CUSTOM_LOOP_LIST</span> <span class="o">=</span> nc

<span class="nv">USER_SCRIPT_RUNTIME_FREQ</span> <span class="o">=</span> RUN_ONCE_FOR_EACH

<span class="nv">USER_SCRIPT_INPUT_DIR</span> <span class="o">=</span> <span class="o">{</span>INPUT_BASE<span class="o">}</span>/model_applications/medium_range/diff_index

<span class="nv">USER_SCRIPT_INPUT_TEMPLATE</span> <span class="o">=</span> <span class="o">{</span>USER_SCRIPT_INPUT_DIR<span class="o">}</span>/wndspd_GEFS_NorthPac_5dy_30mem_<span class="o">{</span>init?fmt<span class="o">=</span>%Y%m%d%H<span class="o">}</span>.npz

<span class="nv">USER_SCRIPT_OUTPUT_DIR</span> <span class="o">=</span> <span class="o">{</span>OUTPUT_BASE<span class="o">}</span>/model_applications/medium_range/diff_index

<span class="nv">USER_SCRIPT_COMMAND</span> <span class="o">=</span> <span class="o">{</span>PARM_BASE<span class="o">}</span>/use_cases/model_applications/medium_range/UserScript_fcstGEFS_Difficulty_Index/wind_difficulty_index.py


<span class="o">[</span>user_env_vars<span class="o">]</span>

<span class="c1"># Difficulty index specific variables</span>

<span class="nv">DIFF_INDEX_INPUT_FILENAME</span> <span class="o">=</span> <span class="o">{</span>USER_SCRIPT_INPUT_TEMPLATE<span class="o">}</span>

<span class="nv">DIFF_INDEX_THRESH_START</span> <span class="o">=</span> <span class="m">10</span>.0 

<span class="nv">DIFF_INDEX_THRESH_END</span> <span class="o">=</span> <span class="m">40</span>.0

<span class="nv">DIFF_INDEX_THRESH_STEP</span> <span class="o">=</span> <span class="m">2</span>.0

<span class="nv">DIFF_INDEX_SAVE_THRESH_START</span> <span class="o">=</span> <span class="m">20</span>.0

<span class="nv">DIFF_INDEX_SAVE_THRESH_STOP</span> <span class="o">=</span> <span class="m">38</span>.0

<span class="nv">DIFF_INDEX_SAVE_THRESH_STEP</span> <span class="o">=</span> <span class="m">2</span>.0

<span class="nv">DIFF_INDEX_UNITS</span> <span class="o">=</span> kn

<span class="nv">DIFF_INDEX_FIG_FMT</span> <span class="o">=</span> png

<span class="nv">DIFF_INDEX_FIG_BASENAME</span> <span class="o">=</span> <span class="o">{</span>USER_SCRIPT_OUTPUT_DIR<span class="o">}</span>/wndspd_GEFS_NorthPac_5dy_30mem_difficulty_index
</pre></div>
</div>
</div>
<div class="section" id="met-configuration">
<h2>MET Configuration<a class="headerlink" href="#met-configuration" title="Permalink to this headline">¶</a></h2>
<p>There are no MET tools used in this use case.</p>
</div>
<div class="section" id="python-embedding">
<h2>Python Embedding<a class="headerlink" href="#python-embedding" title="Permalink to this headline">¶</a></h2>
<p>This use case uses a Python embedding script to read input data</p>
<p>parm/use_cases/model_applications/medium_range/UserScript_fcstGEFS_Difficulty_Index/wind_difficulty_index.py</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Load fieldijn from npz file created with save_ensemble_data.py</span>
<span class="sd">helper function, compute ensemble mean and spread, compute</span>
<span class="sd">difficulty index for a set of thresholds, plot and save the results.</span>
<span class="sd">Author: Bill Campbell, NRL and Lindsay Blank, NCAR</span>

<span class="sd">Taken from original test_difficulty_index.py but replacing with METcalcpy and METplotpy.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">metcalcpy.calc_difficulty_index</span> <span class="kn">import</span> <span class="n">forecast_difficulty</span> <span class="k">as</span> <span class="n">di</span>
<span class="kn">from</span> <span class="nn">metcalcpy.calc_difficulty_index</span> <span class="kn">import</span> <span class="n">EPS</span>
<span class="kn">from</span> <span class="nn">metcalcpy.piecewise_linear</span> <span class="kn">import</span> <span class="n">PiecewiseLinear</span> <span class="k">as</span> <span class="n">plin</span>
<span class="kn">import</span> <span class="nn">metplotpy.plots.difficulty_index.mycolormaps</span> <span class="k">as</span> <span class="nn">mcmap</span>
<span class="kn">from</span> <span class="nn">metplotpy.plots.difficulty_index.plot_difficulty_index</span> <span class="kn">import</span> <span class="n">plot_field</span>


<span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load ensemble data from file&quot;&quot;&quot;</span>
    <span class="n">loaded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span> <span class="o">=</span> <span class="p">(</span><span class="n">loaded</span><span class="p">[</span><span class="s1">&#39;lats&#39;</span><span class="p">],</span> <span class="n">loaded</span><span class="p">[</span><span class="s1">&#39;lons&#39;</span><span class="p">])</span>
    <span class="n">fieldijn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">loaded</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">fieldijn</span>


<span class="k">def</span> <span class="nf">compute_stats</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute mean and std dev&quot;&quot;&quot;</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span>

<span class="k">def</span> <span class="nf">compute_wind_envelope</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes piecewise linear envelope for winds in knots.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Piecewise linear object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Envelope for version 6.1, the default</span>
    <span class="n">xunits</span> <span class="o">=</span> <span class="s1">&#39;kn&#39;</span>
    <span class="n">A6_1_name</span> <span class="o">=</span> <span class="s2">&quot;A6_1&quot;</span>
    <span class="n">A6_1_left</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">A6_1_right</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">A6_1_xlist</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">28.0</span><span class="p">,</span> <span class="mf">34.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">]</span>
    <span class="n">A6_1_ylist</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">Aplin</span> <span class="o">=</span>\
            <span class="n">plin</span><span class="p">(</span><span class="n">A6_1_xlist</span><span class="p">,</span> <span class="n">A6_1_ylist</span><span class="p">,</span> <span class="n">xunits</span><span class="o">=</span><span class="n">xunits</span><span class="p">,</span>
                    <span class="n">right</span><span class="o">=</span><span class="n">A6_1_right</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">A6_1_left</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">A6_1_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Aplin</span>

<span class="k">def</span> <span class="nf">compute_difficulty_index</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">,</span> <span class="n">Aplin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute difficulty index for an ensemble forecast given</span>
<span class="sd">    a set of thresholds, returning a dictionary of fields.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dij</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">:</span>
        <span class="n">dij</span><span class="p">[</span><span class="n">threshold</span><span class="p">]</span> <span class="o">=</span>\
            <span class="n">di</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">Aplin</span><span class="o">=</span><span class="n">Aplin</span><span class="p">,</span> <span class="n">sigma_over_mu_ref</span><span class="o">=</span><span class="n">EPS</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dij</span>


<span class="k">def</span> <span class="nf">plot_difficulty_index</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">,</span> <span class="n">units</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the difficulty index for a set of thresholds,</span>
<span class="sd">    returning a dictionary of figures</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="n">myparams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                <span class="s1">&#39;figure.max_open_warning&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">}</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">myparams</span><span class="p">)</span>
    <span class="n">figs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">mcmap</span><span class="o">.</span><span class="n">stoplight</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dij</span><span class="p">[</span><span class="n">threshold</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="n">figs</span><span class="p">[</span><span class="n">threshold</span><span class="p">]</span> <span class="o">=</span>\
            <span class="n">plot_field</span><span class="p">(</span><span class="n">dij</span><span class="p">[</span><span class="n">threshold</span><span class="p">],</span>
                          <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                          <span class="n">xlab</span><span class="o">=</span><span class="s1">&#39;Longitude </span><span class="se">\u00b0</span><span class="s1">E&#39;</span><span class="p">,</span> <span class="n">ylab</span><span class="o">=</span><span class="s1">&#39;Latitude&#39;</span><span class="p">,</span>
                          <span class="n">clab</span><span class="o">=</span><span class="s1">&#39;thresh=</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">units</span><span class="p">),</span>
                          <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Forecast Decision Difficulty Index&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">figs</span>


<span class="k">def</span> <span class="nf">save_difficulty_figures</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">save_thresh</span><span class="p">,</span> <span class="n">units</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save subset of difficulty index figures.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig_fmt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DIFF_INDEX_FIG_FMT&#39;</span><span class="p">)</span>
    <span class="n">fig_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DIFF_INDEX_FIG_BASENAME&#39;</span><span class="p">)</span>

    <span class="c1"># create output directory if it does not already exist</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fig_basename</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">thresh</span> <span class="ow">in</span> <span class="n">save_thresh</span><span class="p">:</span>
        <span class="n">thresh_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thresh</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="p">(</span><span class="n">fig_basename</span> <span class="o">+</span> <span class="n">thresh_str</span> <span class="o">+</span>
                    <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">fig_fmt</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving </span><span class="si">{}</span><span class="s1">...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fig_name</span><span class="p">))</span>
        <span class="n">figs</span><span class="p">[</span><span class="n">thresh</span><span class="p">]</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_name</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">fig_fmt</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_statistics</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;feet&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot ensemble mean and spread, returning figure handles&quot;&quot;&quot;</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">mcmap</span><span class="o">.</span><span class="n">spectral</span><span class="p">()</span>
    <span class="n">mu_fig</span> <span class="o">=</span>\
        <span class="n">plot_field</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">clab</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
                      <span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span>
                      <span class="n">xlab</span><span class="o">=</span><span class="s1">&#39;Longitude </span><span class="se">\u00b0</span><span class="s1">E&#39;</span><span class="p">,</span>
                      <span class="n">ylab</span><span class="o">=</span><span class="s1">&#39;Latitude&#39;</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Forecast Ensemble Mean&#39;</span><span class="p">)</span>
    <span class="n">sigma_fig</span> <span class="o">=</span>\
        <span class="n">plot_field</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">clab</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
                      <span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span>
                      <span class="n">xlab</span><span class="o">=</span><span class="s1">&#39;Longitude </span><span class="se">\u00b0</span><span class="s1">E&#39;</span><span class="p">,</span>
                      <span class="n">ylab</span><span class="o">=</span><span class="s1">&#39;Latitude&#39;</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Forecast Ensemble Std&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mu_fig</span><span class="p">,</span> <span class="n">sigma_fig</span>


<span class="k">def</span> <span class="nf">save_stats_figures</span><span class="p">(</span><span class="n">mu_fig</span><span class="p">,</span> <span class="n">sigma_fig</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save ensemble mean and spread figures.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fig_fmt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DIFF_INDEX_FIG_FMT&#39;</span><span class="p">)</span>
    <span class="n">fig_basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DIFF_INDEX_FIG_BASENAME&#39;</span><span class="p">)</span>
    <span class="n">mu_name</span> <span class="o">=</span> <span class="n">fig_basename</span> <span class="o">+</span> <span class="s1">&#39;mean.&#39;</span> <span class="o">+</span> <span class="n">fig_fmt</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving </span><span class="si">{}</span><span class="s1">...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mu_name</span><span class="p">))</span>
    <span class="n">mu_fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">mu_name</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">fig_fmt</span><span class="p">)</span>
    <span class="n">sigma_name</span> <span class="o">=</span> <span class="n">fig_basename</span> <span class="o">+</span> <span class="s1">&#39;std.&#39;</span> <span class="o">+</span> <span class="n">fig_fmt</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving </span><span class="si">{}</span><span class="s1">...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigma_name</span><span class="p">))</span>
    <span class="n">sigma_fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">sigma_name</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">fig_fmt</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load fieldijn from npz file created with NCEP_test.py</span>
<span class="sd">    helper function, compute ensemble mean and spread, compute</span>
<span class="sd">    difficulty index for a set of thresholds, plot and save the results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DIFF_INDEX_INPUT_FILENAME&#39;</span><span class="p">)</span>
    <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">fieldijn</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="c1"># Convert m/s to knots</span>
    <span class="n">units</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DIFF_INDEX_UNITS&#39;</span><span class="p">)</span>
    <span class="n">mps2kn</span> <span class="o">=</span> <span class="mf">1.94384</span>
    <span class="n">fieldijn</span> <span class="o">=</span> <span class="n">mps2kn</span> <span class="o">*</span> <span class="n">fieldijn</span>
    <span class="c1"># Ensemble mean, std dev</span>
    <span class="n">muij</span><span class="p">,</span> <span class="n">sigmaij</span> <span class="o">=</span> <span class="n">compute_stats</span><span class="p">(</span><span class="n">fieldijn</span><span class="p">)</span>
    <span class="c1"># Windspeed envelope</span>
    <span class="n">Aplin</span> <span class="o">=</span> <span class="n">compute_wind_envelope</span><span class="p">()</span>
    <span class="c1"># Difficulty index for a set of thresholds</span>
    <span class="c1">#thresholds = np.arange(os.environ.get(&#39;DIFF_INDEX_THRESH_START&#39;), os.environ.get(&#39;DIFF_INDEX_THRESH_END&#39;), os.environ.get(&#39;DIFF_INDEX_THRESH_STEP&#39;))</span>
    <span class="n">start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DIFF_INDEX_THRESH_START&#39;</span><span class="p">))</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DIFF_INDEX_THRESH_END&#39;</span><span class="p">))</span>
    <span class="n">step</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DIFF_INDEX_THRESH_STEP&#39;</span><span class="p">))</span>
    <span class="n">thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
    <span class="n">dij</span> <span class="o">=</span> <span class="n">compute_difficulty_index</span><span class="p">(</span><span class="n">fieldijn</span><span class="p">,</span> <span class="n">muij</span><span class="p">,</span> <span class="n">sigmaij</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">,</span> <span class="n">Aplin</span><span class="o">=</span><span class="n">Aplin</span><span class="p">)</span>
    <span class="c1"># Plot and save difficulty index figures</span>
    <span class="n">figs</span> <span class="o">=</span> <span class="n">plot_difficulty_index</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
    <span class="n">save_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DIFF_INDEX_SAVE_THRESH_START&#39;</span><span class="p">))</span>
    <span class="n">save_stop</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DIFF_INDEX_SAVE_THRESH_STOP&#39;</span><span class="p">))</span>
    <span class="n">save_step</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DIFF_INDEX_SAVE_THRESH_STEP&#39;</span><span class="p">))</span>
    <span class="n">save_thresh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">save_start</span><span class="p">,</span> <span class="n">save_stop</span><span class="p">,</span> <span class="n">save_step</span><span class="p">)</span>
    <span class="n">save_difficulty_figures</span><span class="p">(</span><span class="n">figs</span><span class="p">,</span> <span class="n">save_thresh</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
    <span class="c1"># Plot and save ensemble mean, std_dev</span>
    <span class="n">mu_fig</span><span class="p">,</span> <span class="n">sigma_fig</span> <span class="o">=</span>\
        <span class="n">plot_statistics</span><span class="p">(</span><span class="n">muij</span><span class="p">,</span> <span class="n">sigmaij</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
    <span class="n">save_stats_figures</span><span class="p">(</span><span class="n">mu_fig</span><span class="p">,</span> <span class="n">sigma_fig</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="running-metplus">
<h2>Running METplus<a class="headerlink" href="#running-metplus" title="Permalink to this headline">¶</a></h2>
<p>This use case can be run two ways:</p>
<p>1) Passing in UserScript_fcstGEFS_Difficulty_Index.conf,
then a user-specific system configuration file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">master_metplus</span><span class="o">.</span><span class="n">py</span> \
<span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">METplus</span><span class="o">/</span><span class="n">parm</span><span class="o">/</span><span class="n">use_cases</span><span class="o">/</span><span class="n">model_applications</span><span class="o">/</span><span class="n">medium_range</span><span class="o">/</span><span class="n">UserScript_fcstGEFS_Difficulty_Index</span><span class="o">.</span><span class="n">conf</span> \
<span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">user_system</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
<ol class="arabic" start="2">
<li><p>Modifying the configurations in parm/metplus_config, then passing in UserScript_fcstGEFS_Difficulty_Index.conf:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">master_metplus</span><span class="o">.</span><span class="n">py</span> \
<span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">METplus</span><span class="o">/</span><span class="n">parm</span><span class="o">/</span><span class="n">use_cases</span><span class="o">/</span><span class="n">model_applications</span><span class="o">/</span><span class="n">medium_range</span><span class="o">/</span><span class="n">UserScript_fcstGEFS_Difficulty_Index</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
</li>
</ol>
<p>The former method is recommended. Whether you add them to a user-specific configuration file or modify the metplus_config files, the following variables must be set correctly:</p>
<ul class="simple">
<li><p><strong>INPUT_BASE</strong> - Path to directory where sample data tarballs are unpacked (See Datasets section to obtain tarballs). This is not required to run METplus, but it is required to run the examples in parm/use_cases</p></li>
<li><p><strong>OUTPUT_BASE</strong> - Path where METplus output will be written. This must be in a location where you have write permissions</p></li>
<li><p><strong>MET_INSTALL_DIR</strong> - Path to location where MET is installed locally</p></li>
</ul>
<blockquote>
<div><p>and for the [exe] section, you will need to define the location of NON-MET executables.
If the executable is in the user’s path, METplus will find it from the name.
If the executable is not in the path, specify the full path to the executable here (i.e. RM = /bin/rm)
The following executables are required for performing series analysis use cases:</p>
</div></blockquote>
<p>Example User Configuration File:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="nb">dir</span><span class="p">]</span>
<span class="n">INPUT_BASE</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">sample</span><span class="o">/</span><span class="nb">input</span><span class="o">/</span><span class="n">data</span>
<span class="n">OUTPUT_BASE</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="nb">dir</span>
<span class="n">MET_INSTALL_DIR</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">met</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">Y</span>

<span class="p">[</span><span class="n">exe</span><span class="p">]</span>
<span class="n">RM</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">rm</span>
<span class="n">CUT</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">cut</span>
<span class="n">TR</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">tr</span>
<span class="n">NCAP2</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">ncap2</span>
<span class="n">CONVERT</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">convert</span>
<span class="n">NCDUMP</span> <span class="o">=</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">ncdump</span>
</pre></div>
</div>
</div>
<div class="section" id="expected-output">
<h2>Expected Output<a class="headerlink" href="#expected-output" title="Permalink to this headline">¶</a></h2>
<p>A successful run will output the following both to the screen and to the logfile:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span><span class="p">:</span> <span class="n">METplus</span> <span class="n">has</span> <span class="n">successfully</span> <span class="n">finished</span> <span class="n">running</span><span class="o">.</span>
</pre></div>
</div>
<p>Refer to the value set for <strong>OUTPUT_BASE</strong> to find where the output data was generated.
Output for this use case will be found in a directory relative to <strong>OUTPUT_BASE</strong>. There
should be a list of files that have the following format:</p>
<p>wndspd_GEFS_NorthPac_5dy_30mem_difficulty_indexTHRESH_00_kn.png</p>
<p>Where THRESH isa number between DIFF_INDEX_SAVE_THRESH_START and
DIFF_INDEX_SAVE_THRESH_STOP which are defined in UserScript_fcstGEFS_Difficulty_Index.conf.</p>
</div>
<div class="section" id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://dtcenter.github.io/METplus/develop/search.html?q=UserScriptUseCase&amp;check_keywords=yes&amp;area=default">UserScriptUseCase</a>,
<a class="reference external" href="https://dtcenter.github.io/METplus/search.html?q=MediumRangeAppUseCase&amp;check_keywords=yes&amp;area=default">MediumRangeAppUseCase</a>,
<a class="reference external" href="https://dtcenter.github.io/METplus/search.html?q=NRLOrgUseCase&amp;check_keywords=yes&amp;area=default">NRLOrgUseCase</a></p>
</div>
<p>sphinx_gallery_thumbnail_path = ‘_static/medium_range-UserScript_fcstGEFS_Difficulty_Index.png’</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.000 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-generated-model-applications-medium-range-userscript-fcstgefs-difficulty-index-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../../_downloads/e7645644d818ca9a56a6d3e0c17a34f4/UserScript_fcstGEFS_Difficulty_Index.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">UserScript_fcstGEFS_Difficulty_Index.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../../_downloads/3d1f08c9321d7817c777bacb80391021/UserScript_fcstGEFS_Difficulty_Index.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">UserScript_fcstGEFS_Difficulty_Index.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="TCStat_SeriesAnalysis_fcstGFS_obsGFS_FeatureRelative_SeriesByInit.html" class="btn btn-neutral float-right" title="5.2.6.8. Multi_Tool: Feature Relative by Init" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="GridStat_fcstGFS_obsGFS_Sfc_MultiField.html" class="btn btn-neutral" title="5.2.6.6. Grid-Stat: Standard Verification of Surface Fields" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, UCAR/NCAR, NOAA, CSU/CIRA, and CU/CIRES.
      Last updated on Jan 29, 2021, 4:49:48 PM.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
     
<script>var version_json_loc = "../../../../versions.json";</script>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/pop_ver.js"></script>
    

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>